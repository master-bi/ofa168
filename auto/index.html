<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ­£åœ¨ç‚ºæ‚¨é€£ç·šå®˜æ–¹å…¥å£...</title>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text",
                   "Segoe UI", system-ui, sans-serif;
    }

    body {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #202127 0, #050508 45%, #000 100%);
      color: #f8f5ff;
    }

    .wrapper {
      width: 100%;
      max-width: 420px;
      padding: 16px;
    }

    .card {
      position: relative;
      border-radius: 26px;
      padding: 22px 20px 24px;
      background: linear-gradient(145deg, #141520, #050509);
      overflow: hidden;
      box-shadow:
        0 25px 60px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.03);
      isolation: isolate;
    }

    /* å¤–æ¡†é‡‘è‰²ç·šæ¢ */
    .card::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: 28px;
      background:
        linear-gradient(135deg, rgba(255, 215, 128, 0.45), transparent 40%),
        linear-gradient(315deg, transparent 60%, rgba(255, 246, 196, 0.28));
      opacity: 0.95;
      pointer-events: none;
      z-index: -2;
    }

    /* èƒŒæ™¯ç´°æ ¼ç·š */
    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      background:
        repeating-linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.02) 0,
          rgba(255, 255, 255, 0.02) 1px,
          transparent 1px,
          transparent 6px
        );
      mix-blend-mode: soft-light;
      opacity: 0.7;
      pointer-events: none;
      z-index: -2;
    }

    /* ç™¼å…‰æƒæç·š */
    .scan-line {
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at 0 50%,
                  rgba(255, 235, 175, 0.03) 0,
                  transparent 55%);
      mix-blend-mode: screen;
      animation: scan-move 4.5s linear infinite;
      z-index: -1;
      pointer-events: none;
    }

    @keyframes scan-move {
      0%   { transform: translateX(-40%) skewX(-18deg); opacity: 0.0; }
      20%  { opacity: 0.9; }
      60%  { opacity: 0.9; }
      100% { transform: translateX(60%) skewX(-18deg); opacity: 0; }
    }

    .logo-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }

    .logo-dot {
      width: 36px;
      height: 36px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, #fff, #c5c5c5);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #111;
      box-shadow: 0 12px 22px rgba(0, 0, 0, 0.7),
                  0 0 18px rgba(255, 222, 150, 0.75);
      animation: logo-pulse 2.4s ease-in-out infinite;
    }

    @keyframes logo-pulse {
      0%, 100% {
        transform: translateY(0) scale(1);
        box-shadow: 0 12px 22px rgba(0, 0, 0, 0.7),
                    0 0 12px rgba(255, 222, 150, 0.45);
      }
      50% {
        transform: translateY(-2px) scale(1.04);
        box-shadow: 0 16px 28px rgba(0, 0, 0, 0.9),
                    0 0 24px rgba(255, 243, 194, 0.9);
      }
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .logo-text-main {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.06em;
    }

    .logo-text-sub {
      font-size: 12px;
      opacity: 0.7;
    }

    .region-pill {
      margin-top: 6px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      background: linear-gradient(135deg, rgba(255, 226, 150, 0.16), rgba(255, 255, 255, 0.02));
      box-shadow: 0 0 0 1px rgba(255, 224, 158, 0.35),
                  0 0 12px rgba(255, 204, 102, 0.45);
      color: #ffefc4;
    }

    .region-pill-flag {
      font-size: 14px;
    }

    .region-pill-reason {
      opacity: .8;
    }

    .status {
      margin-bottom: 16px;
      margin-top: 6px;
    }

    .status-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .status-sub {
      font-size: 13px;
      opacity: 0.85;
      line-height: 1.5;
    }

    /* Loader å€å¡Š */
    .loader-row {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 22px 0 14px;
    }

    .spinner {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 2px solid rgba(255, 255, 255, 0.12);
      border-top-color: #ffd66b;
      border-right-color: #ffefba;
      animation: spin 900ms linear infinite;
      box-shadow: 0 0 18px rgba(255, 214, 107, 0.5);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loader-text {
      font-size: 13px;
      line-height: 1.5;
      opacity: 0.95;
    }

    /* é€²åº¦æ¢ */
    .progress-bar {
      position: relative;
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-inner {
      position: absolute;
      inset: 0;
      transform-origin: left;
      transform: scaleX(0);
      background: linear-gradient(90deg, #ffdd82, #ffeebb, #ffffff);
      box-shadow: 0 0 18px rgba(255, 214, 107, 0.7);
      animation: progress-fill 5s ease-out forwards;
    }

    @keyframes progress-fill {
      0%   { transform: scaleX(0.18); }
      25%  { transform: scaleX(0.4); }
      50%  { transform: scaleX(0.65); }
      75%  { transform: scaleX(0.9); }
      100% { transform: scaleX(1); }
    }

    .progress-label {
      font-size: 12px;
      opacity: 0.7;
      display: flex;
      justify-content: space-between;
    }

    .hint {
      margin-top: 18px;
      font-size: 12px;
      opacity: 0.63;
      line-height: 1.5;
    }

    .manual-btn {
      margin-top: 18px;
      width: 100%;
      border-radius: 999px;
      padding: 12px 16px;
      border: none;
      cursor: pointer;
      background: radial-gradient(circle at 30% 0, #fff8d4, #ffcf61, #b78628);
      color: #000;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.06em;
      box-shadow:
        0 12px 28px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .manual-btn span.icon {
      font-size: 16px;
    }

    .manual-btn:active {
      transform: translateY(1px);
      box-shadow:
        0 9px 20px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 255, 255, 0.15);
    }

    @media (max-width: 480px) {
      .card {
        padding: 20px 18px 22px;
      }
      .logo-text-main {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <div class="scan-line"></div>

      <div class="logo-row">
        <div class="logo-dot">XC</div>
        <div class="logo-text">
          <div class="logo-text-main">XC å®˜æ–¹è·³è½‰ä¸­å¿ƒ</div>
          <div class="logo-text-sub">ç‚ºä½ é€£ç·šæœ€è¿‘ä¸”ç©©å®šçš„éŠæˆ²å…¥å£</div>
          <div class="region-pill" id="regionPill" style="display:none;">
            <span class="region-pill-flag" id="regionFlag">ğŸŒ</span>
            <span id="regionLabel">é è¨­ç¯€é»</span>
            <span class="region-pill-reason" id="regionReason">åµæ¸¬ä¸­...</span>
          </div>
        </div>
      </div>

      <div class="status">
        <div class="status-title" id="statusTitle">æ­£åœ¨ç‚ºä½ åµæ¸¬åœ°å€...</div>
        <div class="status-sub" id="statusSub">
          æˆ‘å€‘æœƒä¾ç…§ä½ çš„ <strong>IP åœ°å€èˆ‡èªç³»</strong>ï¼Œ
          è‡ªå‹•å°å‘æœ€è¿‘çš„ OFA168 å®˜æ–¹è¨»å†Šé ï¼Œè«‹ç¨å€™æ•¸ç§’ã€‚
        </div>
      </div>

      <div class="loader-row">
        <div class="spinner"></div>
        <div class="loader-text" id="loaderText">
          å»ºç«‹åŠ å¯†é€£ç·šä¸­ï¼Œè«‹ä¿æŒç¶²è·¯ç©©å®šï¼Œä¸è¦é—œé–‰æ­¤è¦–çª—ã€‚
        </div>
      </div>

      <div class="progress-bar">
        <div class="progress-inner"></div>
      </div>
      <div class="progress-label">
        <span>é€£ç·šåˆå§‹åŒ–</span>
        <span id="progressHint">0%</span>
      </div>

      <div class="hint" id="hintText">
        é€šå¸¸æœƒåœ¨ <strong>3â€“6 ç§’å…§</strong> è‡ªå‹•å®Œæˆè·³è½‰ï¼›
        è‹¥è¶…é 10 ç§’ä»æœªè·³è½‰ï¼Œä½ å¯ä»¥é»æ“Šä¸‹æ–¹æŒ‰éˆ•æ‰‹å‹•å‰å¾€å®˜æ–¹å…¥å£ã€‚
      </div>

      <button class="manual-btn" id="manualBtn" style="display:none;">
        <span class="icon">â†ª</span>
        <span id="manualBtnLabel">æ‰‹å‹•å‰å¾€é è¨­å…¥å£</span>
      </button>
    </div>
  </div>

  <script>
    // === ç›®çš„åœ°è¨­å®šï¼šä¾åœ‹å®¶ä»£ç¢¼åˆ†æµ ===
    const DESTS = {
      TW: "https://ag223.gm89.net/login?id=register",
      HK: "https://fbads.ds88hk.net/login?id=register",
      MY: "https://fbads.ofa168my.com/login?id=register",
      KH: "https://fbads.ofa88kh.com/login?id=register",
    };

    // æ²’æœ‰åŒ¹é…åˆ°æ™‚çš„é è¨­å‚™æ´
    const FALLBACK = DESTS.TW;

    const statusTitle  = document.getElementById("statusTitle");
    const statusSub    = document.getElementById("statusSub");
    const loaderText   = document.getElementById("loaderText");
    const hintText     = document.getElementById("hintText");
    const manualBtn    = document.getElementById("manualBtn");
    const manualLabel  = document.getElementById("manualBtnLabel");
    const progressHint = document.getElementById("progressHint");

    const regionPill   = document.getElementById("regionPill");
    const regionFlag   = document.getElementById("regionFlag");
    const regionLabel  = document.getElementById("regionLabel");
    const regionReason = document.getElementById("regionReason");

    // å‡é€²åº¦æ¢æ•¸å­—ï¼Œåªæ˜¯è¦–è¦ºæç¤º
    let fakeProgress = 0;
    const progressTimer = setInterval(() => {
      fakeProgress = Math.min(100, fakeProgress + 7);
      progressHint.textContent = fakeProgress + "%";
      if (fakeProgress >= 100) clearInterval(progressTimer);
    }, 350);

    // æŠŠåŸæœ¬ç¶²å€ä¸Šçš„ query string ä¸€èµ·å¸¶åˆ°ç›®æ¨™ç¶²å€
    function buildUrlWithParams(base) {
      const qs = window.location.search;
      if (!qs || qs === "?") return base;
      return base + (base.includes("?") ? "&" : "?") + qs.substring(1);
    }

    // é¡¯ç¤ºåµæ¸¬åˆ°çš„ç¯€é» + åœ‹æ——
    function updateRegionPill(code, byText, countryNameFallback) {
      const map = {
        TW: {flag:"ğŸ‡¹ğŸ‡¼", label:"å°ç£ç¯€é»"},
        HK: {flag:"ğŸ‡­ğŸ‡°", label:"é¦™æ¸¯ç¯€é»"},
        MY: {flag:"ğŸ‡²ğŸ‡¾", label:"é¦¬ä¾†è¥¿äºç¯€é»"},
        KH: {flag:"ğŸ‡°ğŸ‡­", label:"æŸ¬åŸ”å¯¨ç¯€é»"},
      };
      const info = map[code] || {flag:"ğŸŒ", label: countryNameFallback || "é è¨­ç¯€é»"};

      regionFlag.textContent  = info.flag;
      regionLabel.textContent = info.label;
      regionReason.textContent = byText;
      regionPill.style.display = "inline-flex";
    }

    // èªç³»åˆ¤æ–·å‚™æ´
    function chooseByLanguage(defaultCode) {
      const lang = (navigator.language || "").toLowerCase();

      if (lang.includes("zh-hk") || lang.includes("zh-mo")) return "HK";
      if (lang.includes("ms") || lang.includes("my"))       return "MY";
      if (lang.includes("km"))                             return "KH";
      if (lang.includes("zh-tw") || lang.includes("zh-hant")) return "TW";

      return defaultCode;
    }

    function redirectTo(targetCode, reason) {
      const base = DESTS[targetCode] || FALLBACK;
      const url  = buildUrlWithParams(base);

      statusTitle.textContent = "å³å°‡å‰å¾€ã€Œ" + targetCode + "ã€å®˜æ–¹å…¥å£...";
      loaderText.textContent  = "å®Œæˆè·¯ç”±é¸æ“‡ï¼ˆ" + reason + "ï¼‰ï¼Œæ­£åœ¨å¸¶ä½ å‰å¾€å®‰å…¨é€£ç·šé é¢ã€‚";
      fakeProgress = 96;
      progressHint.textContent = "96%";

      setTimeout(() => {
        window.location.href = url;
      }, 600);
    }

    function showManual(targetCode) {
      const base = DESTS[targetCode] || FALLBACK;
      const url  = buildUrlWithParams(base);

      manualLabel.textContent = "æ‰‹å‹•å‰å¾€ã€Œ" + targetCode + "ã€å®˜æ–¹å…¥å£";
      manualBtn.style.display = "flex";
      manualBtn.onclick = () => {
        window.location.href = url;
      };
    }

    // fetch åŠ  timeoutï¼Œé¿å…å¡æ­»
    function fetchWithTimeout(resource, options = {}) {
      const { timeout = 3000 } = options;

      return Promise.race([
        fetch(resource, options),
        new Promise((_, reject) =>
          setTimeout(() => reject(new Error("timeout")), timeout)
        )
      ]);
    }

    async function detectAndRedirect() {
      let chosenCode = "TW";

      try {
        const res = await fetchWithTimeout("https://ipapi.co/json/", { timeout: 3000 });
        const data = await res.json();
        const cc   = (data.country || data.country_code || "").toUpperCase();

        // å…ˆçœ‹ IP åœ‹å®¶
        if (cc === "TW") chosenCode = "TW";
        else if (cc === "HK") chosenCode = "HK";
        else if (cc === "MY") chosenCode = "MY";
        else if (cc === "KH") chosenCode = "KH";
        else {
          // ä¸åœ¨å››å€‹åœ‹å®¶çš„è©±ï¼Œç”¨èªç³»åˆ¤æ–·
          chosenCode = chooseByLanguage("TW");
        }

        const countryName = data.country_name || cc || "æœªçŸ¥åœ°å€";

        statusSub.textContent =
          "å·²åµæ¸¬åˆ°ä½ çš„åœ°å€ç‚ºã€Œ" + countryName +
          "ã€ï¼Œæ­£åœ¨ç‚ºä½ é¸æ“‡æœ€é©åˆçš„éŠæˆ²å…¥å£...";
        updateRegionPill(chosenCode, "ä¾ IP / èªç³»åˆ¤æ–·", countryName);

        redirectTo(chosenCode, "IP / èªç³»åˆ¤æ–·");
      } catch (err) {
        console.error(err);

        // API æ›æ‰æˆ– timeoutï¼šåªç”¨èªç³»åˆ¤æ–·ï¼Œæœ€å¾Œ fallback TW
        chosenCode = chooseByLanguage("TW");
        statusTitle.textContent = "åœ°å€åµæ¸¬æœå‹™æš«æ™‚ç„¡æ³•é€£ç·š";
        statusSub.textContent   = "å°‡ä½¿ç”¨ä½ çš„ç€è¦½å™¨èªç³»ï¼Œç‚ºä½ é¸æ“‡é è¨­å…¥å£ã€‚";
        loaderText.textContent  = "ä½¿ç”¨å‚™æ´æ¨¡å¼è·³è½‰ä¸­ï¼Œè«‹ç¨å€™ã€‚";

        updateRegionPill(chosenCode, "å‚™æ´æ¨¡å¼åˆ¤æ–·");

        setTimeout(() => {
          redirectTo(chosenCode, "å‚™æ´åˆ¤æ–·");
        }, 1200);
      }

      // è¶…é 8 ç§’é‚„æ²’è·³è½‰ï¼Œå°±é¡¯ç¤ºæ‰‹å‹•æŒ‰éˆ•
      setTimeout(() => {
        showManual(chosenCode);
        hintText.textContent =
          "è‹¥ç•«é¢é•·æ™‚é–“åœç•™åœ¨æ­¤é ï¼Œä½ å¯ä»¥é»æ“ŠæŒ‰éˆ•æ‰‹å‹•å‰å¾€å®˜æ–¹å…¥å£ã€‚";
      }, 8000);
    }

    detectAndRedirect();
  </script>
</body>
</html>
